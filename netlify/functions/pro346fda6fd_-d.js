import{createClient}from"@supabase/supabase-js";const supabase=createClient(process.env.PUBLIC_SUPA_URL,process.env.PUBLIC_SUPA_R_KEY);export async function handler(e){try{const{reference:s,user_id:t}=JSON.parse(e.body),a=await fetch(`https://api.paystack.co/transaction/verify/${s}`,{headers:{Authorization:`Bearer ${process.env.PAYSTACK_SEC_KEY}`}}),r=await a.json();if(!r.status||"success"!==r.data.status)return{statusCode:400,body:JSON.stringify({success:!1})};const{error:i}=await supabase.from("profiles").update({status:"verified",plan:"yearly",verified_at:new Date}).eq("id",t);if(i)throw i;return{statusCode:200,body:JSON.stringify({success:!0})}}catch(e){return{statusCode:500,body:JSON.stringify({error:e.message})}}}
